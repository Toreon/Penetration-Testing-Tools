<div class="catalogue-container" #catalogueContainer>
  <!-- Header with Search and Sort -->
  <div class="header-section">
    <div class="header-content">
      <h1>Tools Catalogue</h1>
      <p class="subtitle">Discover and explore penetration testing tools</p>
    </div>
    
    <div class="search-sort-bar">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search tools...</mat-label>
        <input matInput [formControl]="searchControl" placeholder="Search by name, description, or tags">
        <mat-icon matPrefix>search</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline" class="sort-field">
        <mat-label>Sort by</mat-label>
        <mat-select [formControl]="sortControl">
          <mat-option value="stars-desc">⭐ Most Popular</mat-option>
          <mat-option value="stars-asc">⭐ Least Popular</mat-option>
          <mat-option value="name-asc">Name (A-Z)</mat-option>
          <mat-option value="name-desc">Name (Z-A)</mat-option>
          <mat-option value="added_at-desc">Recently Added</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Filters Panel (Collapsible) -->
    <div class="filters-panel" [class.expanded]="filtersExpanded">
      <div class="filters-header" (click)="toggleFilters()">
        <h2>
          <mat-icon>filter_list</mat-icon>
          Filters
          @if (activeFiltersCount > 0) {
            <span class="badge">{{ activeFiltersCount }}</span>
          }
        </h2>
        <mat-icon class="toggle-icon">{{ filtersExpanded ? 'expand_less' : 'expand_more' }}</mat-icon>
      </div>

      @if (filtersExpanded) {
      <div class="filters-content">
        <!-- Categories -->
        <div class="filter-group">
          <h3>Categories</h3>
          <div class="chips-container">
            @for (category of categories; track category) {
              <button 
                type="button"
                class="filter-chip" 
                [class.active]="isCategorySelected(category)"
                (click)="toggleCategory(category)">
                {{ formatCategory(category) }}
              </button>
            }
          </div>
        </div>

        <!-- Platforms -->
        <div class="filter-group">
          <h3>Platforms</h3>
          <div class="checkbox-group">
            @for (platform of platforms; track platform) {
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  [checked]="isPlatformSelected(platform)"
                  (change)="togglePlatform(platform, $event.target.checked)">
                <span>{{ platform }}</span>
              </label>
            }
          </div>
        </div>

        <!-- Licenses -->
        <div class="filter-group">
          <h3>License</h3>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Select License</mat-label>
            <mat-select [formControl]="$any(filterForm.get('licenses'))" multiple>
              @for (license of licenses; track license) {
                <mat-option [value]="license">{{ license }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Maturity -->
        <div class="filter-group">
          <h3>Maturity</h3>
          <div class="maturity-buttons">
            <button 
              type="button"
              class="maturity-btn" 
              [class.active]="isMaturitySelected('stable')"
              (click)="toggleMaturity('stable')">
              Stable
            </button>
            <button 
              type="button"
              class="maturity-btn" 
              [class.active]="isMaturitySelected('active')"
              (click)="toggleMaturity('active')">
              Active
            </button>
            <button 
              type="button"
              class="maturity-btn" 
              [class.active]="isMaturitySelected('experimental')"
              (click)="toggleMaturity('experimental')">
              Experimental
            </button>
            <button 
              type="button"
              class="maturity-btn" 
              [class.active]="isMaturitySelected('archived')"
              (click)="toggleMaturity('archived')">
              Archived
            </button>
          </div>
        </div>

        <button mat-stroked-button (click)="clearFilters()" class="clear-button">
          <mat-icon>clear</mat-icon>
          Clear All Filters
        </button>
      </div>
      }
    </div>

    <!-- Tools Grid -->
    <div class="tools-section">
      @if (loading && filteredTools.length === 0) {
        <div class="loading-state">
          <mat-spinner diameter="50"></mat-spinner>
          <p>Loading tools...</p>
        </div>
      } @else if (!loading && filteredTools.length === 0) {
        <div class="no-results">
          <mat-icon>search_off</mat-icon>
          <h3>No tools found</h3>
          <p>Try adjusting your filters or search query</p>
          <button mat-raised-button color="primary" (click)="clearFilters()">
            Clear All Filters
          </button>
        </div>
      } @else {
        <div class="results-info">
          <span class="count">{{ filteredTools.length }} tool{{ filteredTools.length !== 1 ? 's' : '' }} found</span>
        </div>
        <div class="tools-grid">
          @for (tool of filteredTools; track tool.id) {
            <mat-card class="tool-card" [routerLink]="['/tools', tool.id]">
              <div class="card-header">
                <h3 class="tool-name">{{ tool.name }}</h3>
                @if (tool.stars) {
                  <div class="stars-badge">
                    <mat-icon>star</mat-icon>
                    <span>{{ tool.stars | number }}</span>
                  </div>
                }
              </div>
              <p class="tool-summary">{{ tool.summary }}</p>
              <div class="tool-meta">
                <div class="categories">
                  @for (category of tool.categories.slice(0, 3); track category) {
                    <span class="category-badge">{{ formatCategory(category) }}</span>
                  }
                  @if (tool.categories.length > 3) {
                    <span class="category-badge more">+{{ tool.categories.length - 3 }}</span>
                  }
                </div>
                <div class="platforms">
                  @for (platform of tool.platforms.slice(0, 2); track platform) {
                    <span class="platform-tag">{{ platform }}</span>
                  }
                  @if (tool.platforms.length > 2) {
                    <span class="platform-tag more">+{{ tool.platforms.length - 2 }}</span>
                  }
                </div>
              </div>
              <div class="card-footer">
                <span class="maturity-badge" [class]="'maturity-' + tool.maturity">
                  {{ tool.maturity }}
                </span>
                <span class="license-badge">{{ tool.license }}</span>
              </div>
            </mat-card>
          }
        </div>
      }
    </div>
  </div>
</div>
