@if (loading) {
  <div class="loading">
    <p>Loading tool information...</p>
  </div>
} @else if (tool) {
  <div class="tool-detail-container">
    <div class="header-section">
      <button mat-button routerLink="/tools">
        <mat-icon>arrow_back</mat-icon>
        Back to Catalogue
      </button>
      <div class="header-content">
        @if (tool.image_url) {
          <img [src]="tool.image_url" [alt]="tool.name + ' logo'" class="tool-image">
        }
        <div class="header-text">
          <h1>{{ tool.name }}</h1>
          @if (currentStars !== null || tool.stars) {
            <div class="stars">
              <mat-icon>star</mat-icon>
              <span>{{ currentStars ?? tool.stars | number }}</span>
            </div>
          }
        </div>
      </div>
    </div>

    <div class="content-grid">
      <div class="main-content">
        <mat-card class="summary-card">
          <mat-card-content>
            <h2>Summary</h2>
            <p>{{ tool.summary }}</p>
            @if (tool.description) {
              <div class="description">
                <h3>Description</h3>
                <p [innerHTML]="tool.description.replace(/\n/g, '<br>')"></p>
              </div>
            }
          </mat-card-content>
        </mat-card>

        @if (tool.use_cases && tool.use_cases.length > 0) {
          <mat-card class="use-cases-card">
            <mat-card-header>
              <mat-card-title>Use Cases</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <ul>
                @for (useCase of tool.use_cases; track useCase) {
                  <li>{{ useCase }}</li>
                }
              </ul>
            </mat-card-content>
          </mat-card>
        }

        @if (tool.installation && ((tool.installation.methods && tool.installation.methods.length > 0) || (tool.installation.commands && tool.installation.commands.length > 0))) {
          <mat-card class="installation-card">
            <mat-card-header>
              <mat-card-title>Installation</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              @if (tool.installation.methods && tool.installation.methods.length > 0) {
                <div class="installation-methods">
                  <h4>Methods:</h4>
                  <ul>
                    @for (method of tool.installation.methods; track method) {
                      <li>{{ method }}</li>
                    }
                  </ul>
                </div>
              }
              @if (tool.installation.commands && tool.installation.commands.length > 0) {
                <div class="installation-commands">
                  <h4>Commands:</h4>
                  <pre><code>@for (cmd of tool.installation.commands; track cmd) {
{{ cmd }}
}</code></pre>
                </div>
              }
              @if (tool.installation.package_managers && tool.installation.package_managers.length > 0) {
                <div class="package-managers">
                  <h4>Package Managers:</h4>
                  <div class="package-badges">
                    @for (pm of tool.installation.package_managers; track pm) {
                      <span class="package-badge">{{ pm }}</span>
                    }
                  </div>
                </div>
              }
            </mat-card-content>
          </mat-card>
        }

        @if (relatedTools.length > 0) {
          <mat-card class="related-tools-card">
            <mat-card-header>
              <mat-card-title>Related & Similar Tools</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="related-tools-list">
                @for (relatedTool of relatedTools; track relatedTool.id) {
                  <a mat-button [routerLink]="['/tools', relatedTool.id]">
                    {{ relatedTool.name }}
                  </a>
                }
              </div>
            </mat-card-content>
          </mat-card>
        }
      </div>

      <div class="sidebar">
        @if (tool.image_url) {
          <mat-card class="image-card">
            <mat-card-content>
              <img [src]="tool.image_url" [alt]="tool.name + ' logo'" class="tool-image-large">
            </mat-card-content>
          </mat-card>
        }

        <mat-card class="info-card">
          <mat-card-header>
            <mat-card-title>Information</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="info-item">
              <strong>Categories:</strong>
              <div class="chips">
                @for (category of tool.categories; track category) {
                  <mat-chip>{{ formatCategory(category) }}</mat-chip>
                }
              </div>
            </div>

            <mat-divider></mat-divider>

            <div class="info-item">
              <strong>Platforms:</strong>
              <div class="platforms">
                @for (platform of tool.platforms; track platform) {
                  <span class="platform-badge">{{ platform }}</span>
                }
              </div>
            </div>

            <mat-divider></mat-divider>

            <div class="info-item">
              <strong>License:</strong>
              <span>{{ tool.license }}</span>
            </div>

            <mat-divider></mat-divider>

            <div class="info-item">
              <strong>Maturity:</strong>
              <span class="maturity-badge" [class]="'maturity-' + tool.maturity">
                {{ tool.maturity }}
              </span>
            </div>

            @if (tool.pricing) {
              <mat-divider></mat-divider>
              <div class="info-item">
                <strong>Pricing:</strong>
                <div class="pricing-info">
                  <span class="pricing-type" [class]="'pricing-' + tool.pricing.type">
                    {{ tool.pricing.type.replace('_', ' ') }}
                  </span>
                  @if (tool.pricing.price) {
                    <span class="pricing-price">
                      @if (tool.pricing.currency) {
                        {{ tool.pricing.currency }}
                      }
                      {{ tool.pricing.price }}
                    </span>
                  }
                  @if (tool.pricing.notes) {
                    <p class="pricing-notes">{{ tool.pricing.notes }}</p>
                  }
                </div>
              </div>
            }

            @if (tool.maintainers && tool.maintainers.length > 0) {
              <mat-divider></mat-divider>
              <div class="info-item">
                <strong>Maintainers:</strong>
                <div class="maintainers-list">
                  @for (maintainer of tool.maintainers; track maintainer) {
                    <a [href]="'https://github.com/' + maintainer" target="_blank" rel="noopener" class="maintainer-link">
                      <mat-icon>person</mat-icon>
                      {{ maintainer }}
                    </a>
                  }
                </div>
              </div>
            }

            @if (tool.authors && tool.authors.length > 0) {
              <mat-divider></mat-divider>
              <div class="info-item">
                <strong>Authors:</strong>
                <div class="authors-list">
                  @for (author of tool.authors; track author) {
                    <a [href]="'https://github.com/' + author" target="_blank" rel="noopener" class="author-link">
                      <mat-icon>code</mat-icon>
                      {{ author }}
                    </a>
                  }
                </div>
              </div>
            }

            @if (tool.tags && tool.tags.length > 0) {
              <mat-divider></mat-divider>
              <div class="info-item">
                <strong>Tags:</strong>
                <div class="tags">
                  @for (tag of tool.tags; track tag) {
                    <span class="tag">{{ tag }}</span>
                  }
                </div>
              </div>
            }
          </mat-card-content>
        </mat-card>

        <mat-card class="links-card">
          <mat-card-header>
            <mat-card-title>Links</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="links">
              @if (tool.website) {
                <a mat-raised-button color="primary" [href]="tool.website" target="_blank" rel="noopener">
                  <mat-icon>language</mat-icon>
                  Website
                </a>
              }
              @if (tool.docs_url) {
                <a mat-raised-button [href]="tool.docs_url" target="_blank" rel="noopener">
                  <mat-icon>description</mat-icon>
                  Documentation
                </a>
              }
              @if (tool.download_url) {
                <a mat-raised-button [href]="tool.download_url" target="_blank" rel="noopener">
                  <mat-icon>download</mat-icon>
                  Download
                </a>
              }
              @if (tool.github_repo) {
                <a mat-raised-button [href]="'https://github.com/' + tool.github_repo" target="_blank" rel="noopener">
                  <mat-icon>code</mat-icon>
                  GitHub
                </a>
              }
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
} @else {
  <div class="error">
    <p>Tool not found.</p>
    <button mat-raised-button routerLink="/tools">Back to Catalogue</button>
  </div>
}
